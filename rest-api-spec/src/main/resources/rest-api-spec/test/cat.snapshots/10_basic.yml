---
"Help":
  - do:
      cat.snapshots:
        help: true

  - match:
      $body: |
               /^   id                .+   \n
                    status            .+   \n
                    start_epoch       .+   \n
                    start_time        .+   \n
                    end_epoch         .+   \n
                    end_time          .+   \n
                    duration          .+   \n
                    indices           .+   \n
                    successful_shards .+   \n
                    failed_shards     .+   \n
                    total_shards      .+   \n
                    reason            .+   \n
               $/
---
"Test cat snapshots output":

  - do:
      snapshot.create_repository:
        repository: test_cat_snapshots_1
        body:
          type: fs
          settings:
            location: "test_cat_snapshots_1_loc"

  - do:
      cat.snapshots:
        repository: test_cat_snapshots_1

  - match:
      $body: |
               /^$/

  - do:
      indices.create:
        index: index1
        body:
          settings:
            number_of_shards: "1"
            number_of_replicas: "0"
  - do:
      indices.create:
        index: index2
        body:
          settings:
            number_of_shards: "1"
            number_of_replicas: "0"
  - do:
       cluster.health:
         wait_for_status: green

  - do:
        snapshot.create:
          repository: test_cat_snapshots_1
          snapshot: snap1
          wait_for_completion: true

  - do:
        snapshot.create:
          repository: test_cat_snapshots_1
          snapshot: snap2
          wait_for_completion: true

  - do:
      cat.snapshots:
        repository: test_cat_snapshots_1

  - match:
      $body: |
               /^   snap1\s+ SUCCESS\s+ \d+\s+ \d\d\:\d\d\:\d\d\s+ \d+\s+ \d\d\:\d\d\:\d\d\s+ \S+\s+ 2\s+ 2\s+ 0\s+ 2\s*\n
                    snap2\s+ SUCCESS\s+ \d+\s+ \d\d\:\d\d\:\d\d\s+ \d+\s+ \d\d\:\d\d\:\d\d\s+ \S+\s+ 2\s+ 2\s+ 0\s+ 2\s*\n
               $/

---
"Test deprecated _cat/snapshots endpoint":
  - skip:
      version: " - 2.18.99"
      reason: "Deprecation added in 2.19"
      features: [ "warnings" ]

  - do:
      snapshot.create_repository:
        repository: dep_test_repo
        body:
          type: fs
          settings:
            location: "dep_test_repo_loc"

  - do:
      warnings:
        - "[/_cat/snapshots] is a deprecated endpoint. Please use [/_cat/snapshots/{repository}] instead."
      cat.snapshots:
        q: "repository:dep_test_repo"

  - match:
      $body: |
               /^$/
